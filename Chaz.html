<!DOCTYPE html>
<html>
<head>
  <style>
    #canvas {
      display: block;
      margin: auto;
      border: 1px solid black;
    }
    #letter-blue {
      position: absolute;
      top: 50%;
      left: 50px;
      transform: translateY(-50%);
      font-size: 40px;
      font-weight: bold;
      color: blue;
      z-index: 1;
    }
    #letter-red {
      position: absolute;
      top: 50%;
      right: 50px;
      transform: translateY(-50%);
      font-size: 40px;
      font-weight: bold;
      color: red;
      z-index: 1;
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      z-index: 9999;
      display: none;
    }
    #timer {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      z-index: 1;
    }
    #confidence {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      text-align: center;
      display: none;
      z-index: 2;
    }
    #confidence-buttons button {
      display: block;
      margin-bottom: 10px;
    }
    #submit-button {
      display: none;
      text-align: center;
      margin-top: 20px;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="letter-blue">B</div>
  <div id="letter-red">R</div>
  <canvas id="canvas" width="500" height="500"></canvas>
  <div id="timer"></div>
  <div id="confidence" style="display: none;">
    How confident do you feel?<br>
    <button onclick="submitConfidence(1)">1</button>
    <button onclick="submitConfidence(2)">2</button>
    <button onclick="submitConfidence(3)">3</button>
    <button onclick="submitConfidence(4)">4</button>
    <button onclick="submitConfidence(5)">5</button>
    <br>
    <button onclick="restartShapes()">Submit</button>
  </div>
  <script>
    // Define the shapes and their corresponding log likelihood ratios
    const shapes = [
      {shape: "hexagon", llr: -0.9},
      {shape: "circle", llr: -0.7},
      {shape: "square", llr: -0.5},
      {shape: "triangle", llr: -0.3},
      {shape: "rectangle", llr: 0.3},
      {shape: "semicircle", llr: 0.5},
      {shape: "heart", llr: 0.7},
      {shape: "star", llr: 0.9}
    ];

    // Set up the canvas
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // Initialize variables
    let shapeCounter = 0; // Counter variable for the number of shapes drawn
    const shapeDelay = 500; // Delay between showing shapes in ms
    const maxShapes = 20; // Max number of shapes (20)
    let currentShapeTimeoutId; // Timeout ID for controlling shape drawing
    let startTime; // Start time of shape drawing
    let countdownMilliseconds; // Countdown duration in milliseconds
    let remainingMilliseconds; // Remaining milliseconds on the countdown

    // Define the function to draw a shape at the center of the canvas
    function drawShape() {
      // Clear the canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Generate a random shape index
      const randomShapeIndex = Math.floor(Math.random() * shapes.length);

      // Get the current shape and its log likelihood ratio
      const currentShape = shapes[randomShapeIndex];
      const currentShapeLLR = currentShape.llr;

      // Calculate the concentration value based on the LLR
      const concentration = Math.abs(currentShapeLLR) * 75;

      // Calculate the color based on the concentration value and LLR sign
      let color;

      if (currentShapeLLR < 0) {
        color = `rgba(0, 0, 255, ${concentration / 100})`; // Blue color
      } else {
        color = `rgba(255, 0, 0, ${concentration / 100})`; // Red color
      }

      // Draw the current shape at the center of the canvas
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const size = 100;

      ctx.beginPath();

      switch (currentShape.shape) {
        case "hexagon":
          ctx.moveTo(centerX + size * Math.cos(0), centerY + size * Math.sin(0));
          for (let i = 1; i <= 6; i++) {
            ctx.lineTo(centerX + size * Math.cos(i * 2 * Math.PI / 6), centerY + size * Math.sin(i * 2 * Math.PI / 6));
          }
          break;

        case "circle":
          ctx.arc(centerX, centerY, size / 2, 0, 2 * Math.PI);
          break;

        case "square":
          ctx.rect(centerX - size / 2, centerY - size / 2, size, size);
          break;

        case "triangle":
          ctx.moveTo(centerX - size / 2, centerY + size / 2);
          ctx.lineTo(centerX + size / 2, centerY + size / 2);
          break;

        case "rectangle":
          ctx.rect(centerX - size, centerY - size / 2, 2 * size, size);
          break;

        case "semicircle":
          ctx.arc(centerX, centerY, size / 2, 0, Math.PI, true);
          break;

        case "heart":
          ctx.moveTo(centerX, centerY + size / 4);
          ctx.bezierCurveTo(centerX - size / 2, centerY - size / 2, centerX - size, centerY - size / 4, centerX, centerY + size / 2);
          ctx.bezierCurveTo(centerX + size, centerY - size / 4, centerX + size / 2, centerY - size / 2, centerX, centerY + size / 4);
          break;

        case "star":
          const innerRadius = size / 2;
          const outerRadius = size;
          const spikes = 5;
          const rotation = Math.PI / 2;

          ctx.moveTo(centerX + outerRadius * Math.cos(rotation), centerY + outerRadius * Math.sin(rotation));

          for (let i = 0; i < spikes; i++) {
            const outerX = centerX + outerRadius * Math.cos(rotation + (i * 2 * Math.PI / spikes));
            const outerY = centerY + outerRadius * Math.sin(rotation + (i * 2 * Math.PI / spikes));
            ctx.lineTo(outerX, outerY);

            const innerX = centerX + innerRadius * Math.cos(rotation + ((i + 0.5) * 2 * Math.PI / spikes));
            const innerY = centerY + innerRadius * Math.sin(rotation + ((i + 0.5) * 2 * Math.PI / spikes));
            ctx.lineTo(innerX, innerY);
          }
          break;
      }

      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();

      // Increment the shape counter
      shapeCounter++;

      // Check if the maximum number of shapes has been reached
      if (shapeCounter < maxShapes) {
        // Schedule the next shape to be drawn after the delay
        currentShapeTimeoutId = setTimeout(drawShape, shapeDelay);
      } else {
        // All shapes have been drawn, make the entire screen blank
        document.getElementById("overlay").style.display = "block";
        document.getElementById("confidence").style.display = "block";
      }
    }

    // Start drawing shapes
    startTime = Date.now();
    drawShape();

    // Randomize the countdown duration between 5000 and 10000 milliseconds
    countdownMilliseconds = Math.floor(Math.random() * (10000 - 5000 + 1)) + 5000;

    // Calculate the remaining milliseconds on the countdown
    remainingMilliseconds = countdownMilliseconds - (Date.now() - startTime);

    // Display and update the countdown timer
    const timerElement = document.getElementById("timer");
    timerElement.textContent = remainingMilliseconds;

    function updateTimer() {
      remainingMilliseconds = countdownMilliseconds - (Date.now() - startTime);
      timerElement.textContent = remainingMilliseconds;

      if (remainingMilliseconds <= 0) {
        clearTimeout(currentShapeTimeoutId); // Stop further shape drawing
        document.getElementById("overlay").style.display = "block"; // Display the white screen overlay
        document.body.style.backgroundColor = "white"; // Set the background color to white
        timerElement.style.display = "none"; // Hide the timer
        document.getElementById("confidence").style.display = "block"; // Display the confidence message
      }
    }

    setInterval(updateTimer, 100); // Update the timer every 100 milliseconds

    // Add event listener for arrow key presses
    window.addEventListener("keydown", function(event) {
      if (event.code === "ArrowLeft" || event.code === "ArrowRight") {
        clearTimeout(currentShapeTimeoutId); // Stop further shape drawing

        // Hide all the elements on the screen
        document.getElementById("letter-blue").style.display = "none";
        document.getElementById("letter-red").style.display = "none";
        document.getElementById("canvas").style.display = "none";
        document.getElementById("overlay").style.display = "none";
        document.getElementById("timer").style.display = "none";
        document.getElementById("confidence").style.display = "block";
      }
    });

    let shapesCompleted = false;

    function submitConfidence(confidence) {
      // Handle the user's confidence value here
      // You can do whatever you need with the 'confidence' value
      // For now, we'll just restart the drawing of shapes

      // Show all the elements on the screen except the confidence message
      document.getElementById("letter-blue").style.display = "block";
      document.getElementById("letter-red").style.display = "block";
      document.getElementById("canvas").style.display = "block";
      document.getElementById("confidence").style.display = "none";
      document.getElementById("timer").style.display = "block";

      // Start drawing shapes again only if not already completed
      if (!shapesCompleted) {
         shapeCounter = 0;
         document.body.style.backgroundColor = "transparent"; // Reset background color
         currentShapeTimeoutId = setTimeout(drawShape, shapeDelay);
         startTime = Date.now();
         countdownMilliseconds = Math.floor(Math.random() * (10000 - 5000 + 1)) + 5000;
         remainingMilliseconds = countdownMilliseconds;
         updateTimer();
       }
     }

      // Start drawing shapes again
      shapeCounter = 0;
      document.body.style.backgroundColor = "transparent"; // Reset background color
      currentShapeTimeoutId = setTimeout(drawShape, shapeDelay);
      startTime = Date.now();
      countdownMilliseconds = Math.floor(Math.random() * (10000 - 5000 + 1)) + 5000;
      remainingMilliseconds = countdownMilliseconds;
      updateTimer();

      function restartShapes() {
        document.getElementById("letter-blue").style.display = "block";
        document.getElementById("letter-red").style.display = "block";
        document.getElementById("canvas").style.display = "block";
        document.getElementById("confidence").style.display = "none";
        document.getElementById("timer").style.display = "block";
        shapeCounter = 0;
        shapesCompleted = false;
        document.body.style.backgroundColor = "transparent"; // Reset background color
        currentShapeTimeoutId = setTimeout(drawShape, shapeDelay);
        startTime = Date.now();
        countdownMilliseconds = Math.floor(Math.random() * (10000 - 5000 + 1)) + 5000;
        remainingMilliseconds = countdownMilliseconds;
        updateTimer();
      }

      // Update the timer every 100 milliseconds
      setInterval(updateTimer, 100);

      function updateTimer() {
        remainingMilliseconds = countdownMilliseconds - (Date.now() - startTime);
        remainingMilliseconds = Math.max(remainingMilliseconds, 0); // Prevent negative numbers
        document.getElementById("timer").textContent = remainingMilliseconds;

        if (remainingMilliseconds <= 0) {
          clearTimeout(currentShapeTimeoutId); // Stop further shape drawing
          document.getElementById("overlay").style.display = "block"; // Display the white screen overlay
          document.body.style.backgroundColor = "white"; // Set the background color to white
          document.getElementById("timer").style.display = "none"; // Hide the timer
          document.getElementById("confidence").style.display = "block"; // Display the confidence message
          outOfTimeMessage();
        }
      }

      function outOfTimeMessage() {
        document.getElementById("confidence").innerHTML = "Oh dear, you ran out of time! Click the button below to move on to a new trial :(";
        document.getElementById("confidence").style.display = "block";
      }

      // Add event listener for arrow key presses
      window.addEventListener("keydown", function(event) {
        if (event.code === "ArrowLeft" || event.code === "ArrowRight") {
          clearTimeout(currentShapeTimeoutId); // Stop further shape drawing
          document.getElementById("confidence").style.display = "block"; // Display the confidence message
          document.getElementById("letter-blue").style.display = "none"; // Hide blue letter
          document.getElementById("letter-red").style.display = "none"; // Hide red letter
          document.getElementById("canvas").style.display = "none"; // Hide canvas
          document.getElementById("timer").style.display = "none"; // Hide timer

          // Show the "out of time" message
          outOfTimeMessage();
        }
      });
  </script>
</body>
</html>
